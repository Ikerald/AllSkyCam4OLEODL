<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AllSkyCam4OLEODL.api &mdash; AllSkyCam4OLEODL 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=01f34227"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            AllSkyCam4OLEODL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">AllSkyCam4OLEODL</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AllSkyCam4OLEODL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">AllSkyCam4OLEODL.api</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for AllSkyCam4OLEODL.api</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module contains the API of the Allied Vision Goldeye Camera.</span>

<span class="sd">It has been modified in order to allow both streaming and recording. It</span>
<span class="sd">allows processing of the frames without the need of writting them first.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># C:\Users\alda_ik\Documents\04_PROGRAMMING\02_FINAL_PROJECT\api.py</span>

<span class="kn">from</span> <span class="nn">vmbpy</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># noqa: F403</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">ttk</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">dates</span> <span class="k">as</span> <span class="n">mdates</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">image_processing</span> <span class="k">as</span> <span class="n">im</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">printer</span> <span class="k">as</span> <span class="n">pri</span>

<span class="c1"># All frames will either be recorded in this format, or transformed to it before being displayed</span>
<span class="n">opencv_display_format</span> <span class="o">=</span> <span class="n">PixelFormat</span><span class="o">.</span><span class="n">Bgr8</span>  <span class="c1"># noqa: F405</span>


<div class="viewcode-block" id="feature_changed_handler">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.feature_changed_handler">[docs]</a>
<span class="k">def</span> <span class="nf">feature_changed_handler</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;API propietary printing fuction to indicate a changed of value of a feature.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature (_type_): Feature to be changed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Feature &#39;</span><span class="si">{}</span><span class="s2">&#39; changed value to &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">get_name</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">get</span><span class="p">())),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="abort">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.abort">[docs]</a>
<span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">return_code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">usage</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;API propietary exiting fuction and indicate an error.</span>

<span class="sd">    Args:</span>
<span class="sd">        reason (str): Reason to abort operation.</span>
<span class="sd">        return_code (int, optional): Error code raised. Defaults to 1.</span>
<span class="sd">        usage (bool, optional): Bool to check if an argument has been parsed. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">reason</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">usage</span><span class="p">:</span>
        <span class="n">pri</span><span class="o">.</span><span class="n">print_usage</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">return_code</span><span class="p">)</span></div>



<div class="viewcode-block" id="parse_args">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.parse_args">[docs]</a>
<span class="k">def</span> <span class="nf">parse_args</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;API propietary fuction to parse an argument.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Parsed argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">argc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;/h&quot;</span><span class="p">,</span> <span class="s2">&quot;-h&quot;</span><span class="p">):</span>
            <span class="n">pri</span><span class="o">.</span><span class="n">print_usage</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span>
            <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Invalid number of arguments. Abort.&quot;</span><span class="p">,</span>
            <span class="n">return_code</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">usage</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">argc</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>



<div class="viewcode-block" id="get_camera">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.get_camera">[docs]</a>
<span class="k">def</span> <span class="nf">get_camera</span><span class="p">(</span><span class="n">camera_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Camera</span><span class="p">:</span>  <span class="c1"># noqa: F405</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;API propietary fuction to obtain the camera.</span>

<span class="sd">    Args:</span>
<span class="sd">        camera_id (Optional[str]): Specific camera we want to connect to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Camera: Camera we have connected to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">VmbSystem</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span> <span class="k">as</span> <span class="n">vmb</span><span class="p">:</span>  <span class="c1"># noqa: F405</span>
        <span class="c1"># ip = vmb.GevDeviceForceIPAddress.get()</span>
        <span class="k">if</span> <span class="n">camera_id</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">vmb</span><span class="o">.</span><span class="n">get_camera_by_id</span><span class="p">(</span><span class="n">camera_id</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">VmbCameraError</span><span class="p">:</span>  <span class="c1"># noqa: F405</span>
                <span class="n">abort</span><span class="p">(</span><span class="s2">&quot;Failed to access Camera &#39;</span><span class="si">{}</span><span class="s2">&#39;. Abort.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">camera_id</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">cams</span> <span class="o">=</span> <span class="n">vmb</span><span class="o">.</span><span class="n">get_all_cameras</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cams</span><span class="p">:</span>
                <span class="n">abort</span><span class="p">(</span><span class="s2">&quot;No Cameras accessible. Abort.&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">cams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>



<div class="viewcode-block" id="setup_camera">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.setup_camera">[docs]</a>
<span class="k">def</span> <span class="nf">setup_camera</span><span class="p">(</span>
    <span class="n">cam</span><span class="p">:</span> <span class="n">Camera</span><span class="p">,</span>  <span class="c1"># noqa: F405</span>
    <span class="n">gain</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
    <span class="n">exposure</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
    <span class="n">exposure_time_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">iso</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configures the camera based on user inputs:</span>

<span class="sd">    1. Checks camera mode, if the own camera&#39;s background is chosen, it needs be enabled.</span>

<span class="sd">    2. Sets the gain mode, either 0dB or 18dB.</span>

<span class="sd">    3. Selects the exposure mode, Auto or Manual. If Manual, sets the exposure value.</span>

<span class="sd">    4. Enables white balancing if camera supports it.</span>

<span class="sd">    5. Adjusts GeV packet size (just for PoE camera).</span>

<span class="sd">    Args:</span>
<span class="sd">        cam (Camera): Camera object from the VMBPY API module.</span>
<span class="sd">        gain (tk.StringVar): Container of the gain mode (0 [0 dB] or 1 [18 dB]).</span>
<span class="sd">        exposure (tk.StringVar): Container of the exposure mode (Manual or Auto).</span>
<span class="sd">        exposure_time_value (int): Specified exposure value for Manual mode.</span>
<span class="sd">        iso (tk.StringVar): Container of the camera mode: Normal, Hot-pixel substraction, Subtraction or Camera&#39;s BC.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">cam</span><span class="p">:</span>
        <span class="c1"># print(cam.LUTEnable)</span>
        <span class="c1"># lut = cam.LUTEnable.get()</span>
        <span class="c1"># print(cam.LUTEnable.get())</span>
        <span class="c1"># # lut = True</span>
        <span class="c1"># lut = True</span>
        <span class="c1"># print(cam.LUTEnable)</span>
        <span class="c1"># print(lut)</span>
        <span class="c1"># cam.LUTEnable.set(lut)</span>
        <span class="c1"># print(cam.LUTEnable)</span>
        <span class="c1"># print(cam.LUTEnable)</span>
        <span class="c1"># cam.LUTEnable.value(True)</span>
        <span class="c1"># print(cam.LUTEnable)</span>

        <span class="c1"># Default settings</span>
        <span class="n">cam</span><span class="o">.</span><span class="n">BCMode</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Off&quot;</span><span class="p">)</span>
        <span class="n">cam</span><span class="o">.</span><span class="n">IntegrationMode</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;IntegrateWhileRead&quot;</span><span class="p">)</span>
        <span class="c1"># cam.IntegrationMode.set(&quot;IntegrateThenRead&quot;)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">IntegrationMode</span><span class="p">)</span>

        <span class="c1"># Background Correction settings</span>
        <span class="k">if</span> <span class="n">iso</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Camera&#39;s BC&quot;</span><span class="p">:</span>
            <span class="n">cam</span><span class="o">.</span><span class="n">BCMode</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;On&quot;</span><span class="p">)</span>
            <span class="n">cam</span><span class="o">.</span><span class="n">BCIntegrationStart</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">BCMode</span><span class="p">)</span>

        <span class="c1"># lut_enable = cam.LUTEnable</span>
        <span class="c1"># print(lut_enable)</span>
        <span class="c1"># lut_enable.set(True)</span>
        <span class="c1"># print(lut_enable)</span>

        <span class="c1"># Gain settings</span>
        <span class="k">if</span> <span class="n">gain</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1 [18 dB]&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cam</span><span class="o">.</span><span class="n">SensorGain</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Gain1&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">VmbFeatureError</span><span class="p">):</span>  <span class="c1"># noqa: F405</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cam</span><span class="o">.</span><span class="n">SensorGain</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Gain0&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">VmbFeatureError</span><span class="p">):</span>  <span class="c1"># noqa: F405</span>
                <span class="k">pass</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">SensorGain</span><span class="p">)</span>

        <span class="c1"># Exposure settings</span>
        <span class="k">if</span> <span class="n">exposure</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Manual&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cam</span><span class="o">.</span><span class="n">ExposureAuto</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Off&quot;</span><span class="p">)</span>
                <span class="n">exposure_time</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">ExposureTime</span>
                <span class="n">exposure_time</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">exposure_time_value</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">VmbFeatureError</span><span class="p">):</span>  <span class="c1"># noqa: F405</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cam</span><span class="o">.</span><span class="n">ExposureAuto</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Continuous&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">VmbFeatureError</span><span class="p">):</span>  <span class="c1"># noqa: F405</span>
                <span class="k">pass</span>

        <span class="c1"># White balancing settings</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cam</span><span class="o">.</span><span class="n">BalanceWhiteAuto</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Continuous&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">VmbFeatureError</span><span class="p">):</span>  <span class="c1"># noqa: F405</span>
            <span class="k">pass</span>

        <span class="c1"># GeV packet size settings (only available for GigE Cameras)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">get_streams</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">GVSPAdjustPacketSize</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">stream</span><span class="o">.</span><span class="n">GVSPAdjustPacketSize</span><span class="o">.</span><span class="n">is_done</span><span class="p">():</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">VmbFeatureError</span><span class="p">):</span>  <span class="c1"># noqa: F405</span>
            <span class="k">pass</span></div>



<div class="viewcode-block" id="setup_pixel_format">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.setup_pixel_format">[docs]</a>
<span class="k">def</span> <span class="nf">setup_pixel_format</span><span class="p">(</span><span class="n">cam</span><span class="p">:</span> <span class="n">Camera</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: F405</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configures the camera&#39;s pixel format:</span>

<span class="sd">    1. Retrieves all the camera&#39;s compatible color pixel formats.</span>

<span class="sd">    2. Filters out formats not compatible with OpenCV.</span>

<span class="sd">    3. Retrieves all the camera&#39;s compatible monochrome pixel formats.</span>

<span class="sd">    4. Filters out formats not compatible with OpenCV.</span>

<span class="sd">    5. Selects the OpenCV-compatible color pixel format. If none exist, attempts</span>
<span class="sd">    to convert an incompatible format to be compatible. If conversion is not possible,</span>
<span class="sd">    selects an OpenCV-compatible monochrome pixel format.</span>

<span class="sd">    Args:</span>
<span class="sd">        cam (Camera): Camera object from the VMBPY API module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Available color pixel formats. Prefer color formats over monochrome formats</span>
    <span class="n">cam_formats</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">get_pixel_formats</span><span class="p">()</span>
    <span class="n">cam_color_formats</span> <span class="o">=</span> <span class="n">intersect_pixel_formats</span><span class="p">(</span>  <span class="c1"># noqa: F405</span>
        <span class="n">cam_formats</span><span class="p">,</span>
        <span class="n">COLOR_PIXEL_FORMATS</span><span class="p">,</span>  <span class="c1"># noqa: F405</span>
    <span class="p">)</span>
    <span class="n">convertible_color_formats</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="n">f</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cam_color_formats</span>
        <span class="k">if</span> <span class="n">opencv_display_format</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">get_convertible_formats</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">cam_mono_formats</span> <span class="o">=</span> <span class="n">intersect_pixel_formats</span><span class="p">(</span><span class="n">cam_formats</span><span class="p">,</span> <span class="n">MONO_PIXEL_FORMATS</span><span class="p">)</span>  <span class="c1"># noqa: F405</span>
    <span class="n">convertible_mono_formats</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="n">f</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cam_mono_formats</span>
        <span class="k">if</span> <span class="n">opencv_display_format</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">get_convertible_formats</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># Use OpenCV color format</span>
    <span class="k">if</span> <span class="n">opencv_display_format</span> <span class="ow">in</span> <span class="n">cam_formats</span><span class="p">:</span>
        <span class="n">cam</span><span class="o">.</span><span class="n">set_pixel_format</span><span class="p">(</span><span class="n">opencv_display_format</span><span class="p">)</span>

    <span class="c1"># Else convert color to OpenCV format</span>
    <span class="k">elif</span> <span class="n">convertible_color_formats</span><span class="p">:</span>
        <span class="n">cam</span><span class="o">.</span><span class="n">set_pixel_format</span><span class="p">(</span><span class="n">convertible_color_formats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Else use OpenCV monochrome format</span>
    <span class="k">elif</span> <span class="n">convertible_mono_formats</span><span class="p">:</span>
        <span class="n">cam</span><span class="o">.</span><span class="n">set_pixel_format</span><span class="p">(</span><span class="n">convertible_mono_formats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="s2">&quot;Camera does not support an OpenCV compatible format. Abort.&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="upload_lut">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.upload_lut">[docs]</a>
<span class="k">def</span> <span class="nf">upload_lut</span><span class="p">(</span>
    <span class="n">cam</span><span class="p">:</span> <span class="n">Camera</span><span class="p">,</span>  <span class="c1"># noqa: F405</span>
    <span class="n">lut_dataset_selector_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">gain</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: F405</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uploads and enables the LUT:</span>

<span class="sd">    1. Checks the gain to select the correct LUT path.</span>

<span class="sd">    2. Opens the LUT file, loads it into the camera and runs it.</span>

<span class="sd">    3. Prints the directory and selected LUT.</span>

<span class="sd">    Args:</span>
<span class="sd">        cam (Camera): Camera object from the VMBPY API module.</span>
<span class="sd">        lut_dataset_selector_index (int): Index of the selected LUT.</span>
<span class="sd">        gain (tk.StringVar): Container of the gain mode for choosing the LUT (0 [0 dB] or 1 [18 dB]).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set directory</span>
    <span class="k">if</span> <span class="n">gain</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1 [18 dB]&quot;</span><span class="p">:</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">LUT_DIR1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">LUT_DIR0</span>

    <span class="c1"># Read LUT, upload to camera</span>
    <span class="k">with</span> <span class="n">cam</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">fileContent</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">cam</span><span class="o">.</span><span class="n">LUTDatasetSelector</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">lut_dataset_selector_index</span><span class="p">)</span>
            <span class="n">cam</span><span class="o">.</span><span class="n">LUTValueAll</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">fileContent</span><span class="p">)</span>

            <span class="n">cam</span><span class="o">.</span><span class="n">LUTDatasetSave</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;LUT from file </span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s2"> loaded into LUT Nr.</span><span class="si">{</span><span class="n">lut_dataset_selector_index</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="grab_frame">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.grab_frame">[docs]</a>
<span class="k">def</span> <span class="nf">grab_frame</span><span class="p">(</span><span class="n">cam</span><span class="p">:</span> <span class="n">Camera</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: F405</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Captures a frame to be used as a temporal frame:</span>

<span class="sd">    1. Grabs a frame from the camera.</span>

<span class="sd">    2. Saves the frame in the specified directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        cam (Camera): Camera object from the VMBPY API module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">BACKGROUND_FRAME_DIR</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">as_opencv_image</span><span class="p">())</span></div>



<div class="viewcode-block" id="Handler">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.Handler">[docs]</a>
<span class="k">class</span> <span class="nc">Handler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles the mayority of the camera operation.</span>

<span class="sd">    Methods:</span>

<span class="sd">        __init__:                       Initializes the Handler class.</span>

<span class="sd">        update:                         Updates the live graph of the GUI.</span>

<span class="sd">        save_plot:                      Saves the plot stored in the instance.</span>

<span class="sd">        create_camera_control_slider:   Creates an slider, saves it in the instance.</span>

<span class="sd">        set_exposure:                   Updates the exposure value.</span>

<span class="sd">        set_min_max_value:              Updates the minimum or maximum spot size value.</span>

<span class="sd">        __call__:                       Between each frame, sends the frame for</span>
<span class="sd">        processing, prepares for the next one, and checks if the program has stopped.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Handler.__init__">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.Handler.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cam</span><span class="p">:</span> <span class="n">Camera</span><span class="p">,</span>  <span class="c1"># noqa: F405</span>
        <span class="n">exposure_time_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">check</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
        <span class="n">light</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
        <span class="n">gain</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
        <span class="n">iso</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
        <span class="n">elevation_in</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span>
        <span class="n">line</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">,</span>
        <span class="n">xdata</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">ydata</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">el_lb</span><span class="p">,</span>
        <span class="n">int_lb</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the Handler class with the specified camera and plotting</span>
<span class="sd">        parameters, and creates a directory for storing the frames:</span>

<span class="sd">        1. Sets up all necessary instances based on the chosen settings.</span>

<span class="sd">        2. Creates the directory for saving frames according to the specified settings</span>
<span class="sd">        (will be saves in the data directory on the root folder of the project,</span>
<span class="sd">        inside a folder called tracking_images).</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            cam (Camera): Camera object from the VMBPY API module.</span>
<span class="sd">            exposure_time_value (int): Specified exposure value for Manual mode.</span>
<span class="sd">            check (tk.StringVar): Container of the streaming mode.</span>
<span class="sd">            light (tk.StringVar): Container of the time of day.</span>
<span class="sd">            gain (tk.StringVar): Container of the gain mode (0 [0 dB] or 1 [18 dB]).</span>
<span class="sd">            iso (tk.StringVar): Container of the camera mode: Normal, Hot-pixel substraction, Subtraction or Camera&#39;s BC.</span>
<span class="sd">            payload (tk.StringVar): Container of the payload.</span>
<span class="sd">            elevation_in (tk.StringVar): Container of the elevation mode.</span>
<span class="sd">            fig (plt.figure): Figure for the GUI plot.</span>
<span class="sd">            ax (plt.axes): Axes for the GUI plot.</span>
<span class="sd">            line (plt.hlines): Lines for the GUI plot</span>
<span class="sd">            xdata (list): Data for the x-axis for the GUI plot</span>
<span class="sd">            ydata (list): Data for the y-axis for the GUI plot</span>
<span class="sd">            el_lb (numpy.ndarray): Elevation values from the link_budget</span>
<span class="sd">            int_lb(numpy.ndarray): Intensity values from the link budget</span>

<span class="sd">        :no-index:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setting up instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam</span> <span class="o">=</span> <span class="n">cam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_slider</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">H_SENSOR_SIZE</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">V_SENSOR_SIZE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Input instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cond</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Graph instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="n">ydata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">el_lb</span> <span class="o">=</span> <span class="n">el_lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">int_lb</span> <span class="o">=</span> <span class="n">int_lb</span>

        <span class="c1"># Graph&#39;s update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_graph</span><span class="p">,</span>
            <span class="n">interval</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">cache_frame_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Directory where the tracking frames get saved: directory of script.</span>
        <span class="n">d</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">elev_mod</span> <span class="o">=</span> <span class="n">elevation_in</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">gain</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1 [18 dB]&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">iso</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Hot-pixel substraction&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">iso</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Subtraction&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">iso</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Camera&#39;s BC&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">light</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Daytime&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cond</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cond</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">check</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Record&quot;</span><span class="p">:</span>
            <span class="c1"># Directory creation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">exposure_time_value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">foldername_NP</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;exp_AUTO_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">_NP&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">foldername</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;_exp_AUTO_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">foldername</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;exp_AUTO_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">_IS&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">foldername</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;exp_AUTO_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">_CAMERA_BC&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">foldername</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;exp_AUTO_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">_HP&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">foldername_NP</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;exp_</span><span class="si">{</span><span class="n">exposure_time_value</span><span class="si">}</span><span class="s2">us_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">_NP&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">foldername</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;exp_</span><span class="si">{</span><span class="n">exposure_time_value</span><span class="si">}</span><span class="s2">us_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">foldername</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;exp_</span><span class="si">{</span><span class="n">exposure_time_value</span><span class="si">}</span><span class="s2">us_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">_IS&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">foldername</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;exp_</span><span class="si">{</span><span class="n">exposure_time_value</span><span class="si">}</span><span class="s2">us_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">_CAMERA_BC&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">foldername</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;tc_</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;exp_</span><span class="si">{</span><span class="n">exposure_time_value</span><span class="si">}</span><span class="s2">us_GAIN</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">_HP&quot;</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">elevation_in</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Full&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                <span class="n">foldername</span> <span class="o">=</span> <span class="n">foldername</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload</span>
                <span class="n">foldername_NP</span> <span class="o">=</span> <span class="n">foldername_NP</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pnp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;tracking_images&quot;</span><span class="p">,</span> <span class="n">foldername_NP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;tracking_images&quot;</span><span class="p">,</span> <span class="n">foldername</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pnp</span><span class="p">)</span></div>


<div class="viewcode-block" id="Handler.update_graph">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.Handler.update_graph">[docs]</a>
    <span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">Frame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">:</span>  <span class="c1"># noqa: F405</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the live graph of the GUI with new data stored in the current instance (self):</span>

<span class="sd">        1. If data is available, plots it on the graph.</span>

<span class="sd">        2. Adjusts the graph&#39;s horizontal and vertical limits, extends the x-axis by 60</span>
<span class="sd">        seconds, and increase the y-axis limit by 10% of the maximum value.</span>

<span class="sd">        3. Updates the graph&#39;s format as needed.</span>

<span class="sd">        4. Plots the new data on the graph.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            frame (Frame): Frame object from the VMBPY API module.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plt.hlines: Updated graph instance.</span>

<span class="sd">        :no-index:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="p">:</span>  <span class="c1"># If no data, just return</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,)</span>

        <span class="c1"># Ensure xdata is in UTC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span>

        <span class="c1"># Update axis limits</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">60</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">))</span>

        <span class="c1"># Update the formatter to show appropriate range</span>
        <span class="n">locator</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">()</span>
        <span class="c1"># formatter = mdates.AutoDateFormatter(locator)</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="n">mdates</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,)</span></div>


<div class="viewcode-block" id="Handler.save_plot">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.Handler.save_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">save_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the plot stored in the current instance (self):</span>

<span class="sd">        1. If recording mode is selected, sets the plot size, data, title, and labels.</span>

<span class="sd">        2. Adjust the format of the time as H:M:S.</span>

<span class="sd">        3. If a payload is chosen, its name will be added to the plot&#39;s title.</span>

<span class="sd">        4. Saves the plot in the same directory as the recorded frames (stored in the</span>
<span class="sd">        instance).</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>

<span class="sd">        :no-index:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Only save if in recording mode</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>

            <span class="c1"># Enable the grid</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Format the x-axis ticks</span>
            <span class="n">time_format</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [UTC]&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Pixel Value [DN]&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>  <span class="c1"># Rotate and align the tick labels</span>
            <span class="c1"># Adjust layout manually for a tighter fit, but not as tight as plt.tightlayout()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="c1"># plt.tight_layout()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span><span class="si">}</span><span class="s2"> downlink on </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span><span class="si">}</span><span class="s2">_DL_plot.png&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downlink on </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_DL_plot.png&quot;</span>
                <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="Handler.create_camera_control_slider">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.Handler.create_camera_control_slider">[docs]</a>
    <span class="k">def</span> <span class="nf">create_camera_control_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an slider, saves it in the current instance (self) and sets its</span>
<span class="sd">        initial values:</span>

<span class="sd">        1. Creates a slider within the current instance using the CameraControlSlider</span>
<span class="sd">        class.</span>

<span class="sd">        2. Sets the initial values of the minimum and maximum spot size and the</span>
<span class="sd">        exposure with set_initial_values().</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            root (tk.Tk): Main window of the GUI menu.</span>

<span class="sd">        :no-index:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_control_slider</span> <span class="o">=</span> <span class="n">CameraControlSlider</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">current_exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">ExposureTime</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_control_slider</span><span class="o">.</span><span class="n">set_initial_values</span><span class="p">(</span>
            <span class="n">current_exposure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Handler.set_exposure">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.Handler.set_exposure">[docs]</a>
    <span class="k">def</span> <span class="nf">set_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exposure_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the exposure value stored in the current instance (self).</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            exposure_time (int): Exposure time value.</span>
<span class="sd">        :no-index:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># Tries to update the exposure time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">ExposureTime</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">exposure_time</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">VmbFeatureError</span><span class="p">):</span>  <span class="c1"># noqa: F405</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to set exposure time&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Handler.set_min_max_value">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.Handler.set_min_max_value">[docs]</a>
    <span class="k">def</span> <span class="nf">set_min_max_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">siz</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the minimum or maximum spot size value stored in the current</span>
<span class="sd">        instance (self).</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            value (int): Final minimum or maximum spot size value.</span>
<span class="sd">            siz (int): Integer to differenciate if we want to change the minimum or the maximum spot size value,</span>
<span class="sd">            1 for the maximum, 0 for minimum.</span>

<span class="sd">        :no-index:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">siz</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Max value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max value set to: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min value set to: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Handler.__call__">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.Handler.__call__">[docs]</a>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cam</span><span class="p">:</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">Frame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: F405</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Between each frame, sends the current frame for processing, prepares for</span>
<span class="sd">        the next one, and checks if the program has stopped:</span>

<span class="sd">        1. If program shutdown is activated, exits the fuction.</span>

<span class="sd">        2. If a frame has been grabbed, increments the counter and starts image</span>
<span class="sd">        processing.</span>

<span class="sd">        3. Prepares for the next frame and checks if program is stopped (by</span>
<span class="sd">        pressing q / Q)</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            cam (Camera): Camera object from the VMBPY API module.</span>
<span class="sd">            stream (Stream): Stream object from the VMBPY API module.</span>
<span class="sd">            frame (Frame): Frame object from the VMBPY API module.</span>

<span class="sd">        :no-index:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="o">==</span> <span class="n">FrameStatus</span><span class="o">.</span><span class="n">Complete</span><span class="p">:</span>  <span class="c1"># noqa: F405</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Image Processing fuction</span>
            <span class="n">im</span><span class="o">.</span><span class="n">frame_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cam</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="n">cam</span><span class="o">.</span><span class="n">queue_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># Check for &#39;q&#39; key press to stop recording</span>
        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span>
            <span class="s2">&quot;Q&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="CameraControlSlider">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider">[docs]</a>
<span class="k">class</span> <span class="nc">CameraControlSlider</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles the sliders of the GUI menu.</span>

<span class="sd">    Methods:</span>

<span class="sd">        __init__: Initializes the CameraControlSlider class.</span>

<span class="sd">        setup_exposure_slider: Creates the exposure slider.</span>

<span class="sd">        setup_min_value_slider: Creates the minimum spot size value slider.</span>

<span class="sd">        setup_max_value_slider: Creates the maximum spot size value slider</span>

<span class="sd">        update_exposure: Updates the exposure value.</span>

<span class="sd">        update_min_value: Updates the minimum spot size value.</span>

<span class="sd">        update_max_value: Updates the maximum spot size value.</span>

<span class="sd">        update_from_exposure_entry: Updates the exposure value parsed through the button.</span>

<span class="sd">        update_from_min_entry: Updates the minimum spot size value parsed through the button.</span>

<span class="sd">        update_from_max_entry: Updates the maximum spot size value parsed through the button.</span>

<span class="sd">        set_initial_values: Sets the intial values for all the varibales of the sliders.</span>

<span class="sd">    Args:</span>
<span class="sd">        tk (tk.Toplevel): Window where the slider should be created.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CameraControlSlider.__init__">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">,</span> <span class="n">camera_control</span><span class="p">:</span> <span class="n">Handler</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the CameraControlSlider class with the specified</span>
<span class="sd">        GUI parameters, and creates the sliders:</span>

<span class="sd">        1. Sets up all necessary instances for the slider elements in the menu.</span>

<span class="sd">        2. Configures exposure, minimum, and maximum spot size using the appropriate functions.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            master (tk.Tk): Tinker GUI window.</span>
<span class="sd">            camera_control (Handler): Parsed through handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Allows the child class to invoke the constructor of its parent class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_control</span> <span class="o">=</span> <span class="n">camera_control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Camera Control Sliders&quot;</span><span class="p">)</span>
        <span class="c1"># Dimensions adn position of the control sliders (WidthxHeight+X+Y).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;370x285+900+360&quot;</span><span class="p">)</span>

        <span class="c1"># Creates a frame to hold min and max sliders side by side</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_max_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_max_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Slider setup</span>
        <span class="c1"># Exposure slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_exposure_slider</span><span class="p">()</span>
        <span class="c1"># Min value slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_min_value_slider</span><span class="p">()</span>
        <span class="c1"># Max value slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_max_value_slider</span><span class="p">()</span></div>


<div class="viewcode-block" id="CameraControlSlider.setup_exposure_slider">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.setup_exposure_slider">[docs]</a>
    <span class="k">def</span> <span class="nf">setup_exposure_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the exposure slider:</span>

<span class="sd">        1. Initializes all slider elements and converts the exposure to a logarithmic scale.</span>

<span class="sd">        2. Sets up the displayed exposure value and its slider.</span>

<span class="sd">        3. Configures the button to manually change the exposure value.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initial values are converted to a logarithmic scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_exposure</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span> <span class="o">=</span> <span class="mi">3000000</span>  <span class="c1"># 1 second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_min_exposure</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_exposure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_max_exposure</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_exposure</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">DoubleVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_min_exposure</span><span class="p">)</span>
        <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Exposure Control&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_label</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Exposure: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_exposure</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="c1"># Exposure slider settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_slider</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">from_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">to</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
            <span class="n">length</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_exposure</span><span class="p">,</span>  <span class="c1"># Calls the fuction on each value change</span>
            <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_exposure</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_slider</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_entry</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_entry</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_entry</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Return&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_from_exposure_entry</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_set_button</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Set Exposure&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_from_exposure_entry</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_set_button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></div>


<div class="viewcode-block" id="CameraControlSlider.setup_min_value_slider">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.setup_min_value_slider">[docs]</a>
    <span class="k">def</span> <span class="nf">setup_min_value_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the minimum spot size value slider:</span>

<span class="sd">        1. Initializes all slider elements and converts the minimum spot size value to a logarithmic scale.</span>

<span class="sd">        2. Sets up the displayed minimum value and its slider.</span>

<span class="sd">        3. Configures the button to manually change the minimum spot size value.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">H_SENSOR_SIZE</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">V_SENSOR_SIZE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_max_value</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_min</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">DoubleVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>

        <span class="n">min_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_max_frame</span><span class="p">)</span>
        <span class="n">min_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">min_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Minimum Value Control&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_label</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
            <span class="n">min_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Min. Beam Spot Size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_label</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_slider</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
            <span class="n">min_frame</span><span class="p">,</span>
            <span class="n">from_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">to</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_min_value</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_min</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_slider</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_entry</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">min_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_entry</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_entry</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Return&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_from_min_entry</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_set_button</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">min_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Set Min&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_from_min_entry</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_set_button</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span></div>


<div class="viewcode-block" id="CameraControlSlider.setup_max_value_slider">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.setup_max_value_slider">[docs]</a>
    <span class="k">def</span> <span class="nf">setup_max_value_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the maximum spot size value slider:</span>

<span class="sd">        1. Initializes all slider elements and converts the maximum spot size value to a logarithmic scale.</span>

<span class="sd">        2. Sets up the displayed maximum value and its slider.</span>

<span class="sd">        3. Configures the button to manually change the maximum spot size value.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_max</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">DoubleVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_value</span><span class="p">)</span>

        <span class="n">max_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_max_frame</span><span class="p">)</span>
        <span class="n">max_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">max_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Maximum Value Control&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_label</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
            <span class="n">max_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Max Beam Spot Size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_label</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_slider</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
            <span class="n">max_frame</span><span class="p">,</span>
            <span class="n">from_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">to</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_max_value</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_max</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_slider</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_entry</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">max_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_entry</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_entry</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Return&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_from_max_entry</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_set_button</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">max_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Set Max&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_from_max_entry</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_set_button</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span></div>


<div class="viewcode-block" id="CameraControlSlider.update_exposure">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.update_exposure">[docs]</a>
    <span class="k">def</span> <span class="nf">update_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the exposure value parsed through the slider:</span>

<span class="sd">        1. Gets the exposure from the slider and converts it to a logarithmic scale.</span>

<span class="sd">        2. Sends the updated exposure value to the camera.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            event (_type_, optional): Nothing, just compatibility purposes. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposure_slider</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="o">/</span> <span class="mi">1000</span>
            <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_exposure</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_exposure</span><span class="p">)</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_exposure</span>
        <span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">log_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Exposure: </span><span class="si">{</span><span class="n">exposure</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_control</span><span class="o">.</span><span class="n">set_exposure</span><span class="p">(</span><span class="n">exposure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_entry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_entry</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exposure</span><span class="p">))</span></div>


<div class="viewcode-block" id="CameraControlSlider.update_min_value">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.update_min_value">[docs]</a>
    <span class="k">def</span> <span class="nf">update_min_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the minimum spot size value parsed through the slider:</span>

<span class="sd">        1. Gets the minimum spot size value from the slider and converts it to a logarithmic scale.</span>

<span class="sd">        2. If the miniumum sleected spot size value is bigger than the maximum</span>
<span class="sd">        spot size value, the maximum spot size value is selected as the minimum</span>
<span class="sd">        spot size value. If a negative value is selected, it will be converted to 0.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            event (_type_, optional): Nothing, just compatibility purposes. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_slider</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="o">/</span> <span class="mi">1000</span>
            <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span>
        <span class="p">)</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">log_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">min_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Min Value: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Updates min value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_control</span><span class="o">.</span><span class="n">set_min_max_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_entry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_entry</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">))</span></div>


<div class="viewcode-block" id="CameraControlSlider.update_max_value">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.update_max_value">[docs]</a>
    <span class="k">def</span> <span class="nf">update_max_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the maximum spot size value parsed through the slider:</span>

<span class="sd">        1. Gets the maximum spot size value from the slider and converts it to a logarithmic scale.</span>

<span class="sd">        2. The maximum selected spot size value will be the maximum value between</span>
<span class="sd">        the minimum spot size value and the smaller value between the maximum spot</span>
<span class="sd">        size value selected from the slider and whole dimensions of the image.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            event (_type_, optional): Nothing, just compatibility purposes. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_slider</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="o">/</span> <span class="mi">1000</span>
            <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span>
        <span class="p">)</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">log_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">,</span>
            <span class="nb">min</span><span class="p">((</span><span class="n">const</span><span class="o">.</span><span class="n">H_SENSOR_SIZE</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">V_SENSOR_SIZE</span><span class="p">),</span> <span class="n">max_value</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Max Value: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_control</span><span class="o">.</span><span class="n">set_min_max_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_entry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_entry</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span></div>


<div class="viewcode-block" id="CameraControlSlider.update_from_exposure_entry">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.update_from_exposure_entry">[docs]</a>
    <span class="k">def</span> <span class="nf">update_from_exposure_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the exposure value parsed through the button:</span>

<span class="sd">        1. Gets the exposure value and converts it to a logarithmic scale if it</span>
<span class="sd">        is in the correct range. If not, it raises an error.</span>

<span class="sd">        2. Updates the exposure value calling the update_exposure() function.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            event (_type_, optional): Nothing, just compatibility purposes. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Exposure time inputed in the text-box is either bigger than the</span>
<span class="sd">            maximum exposure time or smaller than the smallest exposure time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exposure_entry</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_exposure</span> <span class="o">&lt;=</span> <span class="n">exposure</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="p">:</span>
                <span class="n">log_value</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">exposure</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_exposure</span><span class="p">)</span>
                    <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_exposure</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_exposure</span><span class="p">)</span>
                    <span class="o">*</span> <span class="mi">1000</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exposure_slider</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">log_value</span><span class="p">)</span>
                <span class="c1"># Updates the exposure value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_exposure</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposure_entry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposure_entry</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_exposure</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="CameraControlSlider.update_from_min_entry">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.update_from_min_entry">[docs]</a>
    <span class="k">def</span> <span class="nf">update_from_min_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the minimum spot size value parsed through the button:</span>

<span class="sd">        1. Gets the minimum spot size value and converts it to a logarithmic scale if</span>
<span class="sd">        it is bigger than zero but smaller than the maximum value.</span>

<span class="sd">        2. Updates the minimum spot size value calling the update_min_value() function.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            event (_type_, optional): Nothing, just compatibility purposes. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Minimum spot size value is either smaller than zero or bigger</span>
<span class="sd">            than the maximum spot size value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">min_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_entry</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">min_value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="n">min_value</span>
                <span class="n">log_value</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_value</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
                    <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
                    <span class="o">*</span> <span class="mi">1000</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_slider</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">log_value</span><span class="p">)</span>
                <span class="c1"># Updates the min spot value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_min_value</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_entry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_entry</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">))</span></div>


<div class="viewcode-block" id="CameraControlSlider.update_from_max_entry">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.update_from_max_entry">[docs]</a>
    <span class="k">def</span> <span class="nf">update_from_max_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the maximum spot size value parsed through the button:</span>

<span class="sd">        1. Gets the maximum spot size value and converts it to a logarithmic scale</span>
<span class="sd">        if it is bigger or equal to the minimum spot size values and smaller or equal</span>
<span class="sd">        than the full image.</span>

<span class="sd">        2. Updates the maximum spot size value calling the update_max_value() function.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            event (_type_, optional): Nothing, just compatibility purposes. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Maximum spot size value is either bigger than the dimensions of</span>
<span class="sd">            the whole frame or smaller than the minimum spot size value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_entry</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">max_value</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="ow">and</span> <span class="n">max_value</span> <span class="o">&lt;=</span> <span class="p">(</span>
                <span class="n">const</span><span class="o">.</span><span class="n">H_SENSOR_SIZE</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">V_SENSOR_SIZE</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">max_value</span>
                <span class="n">log_value</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
                    <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
                    <span class="o">*</span> <span class="mi">1000</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_slider</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">log_value</span><span class="p">)</span>
                <span class="c1"># Updates the max spot value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_max_value</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_entry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_entry</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span></div>


<div class="viewcode-block" id="CameraControlSlider.set_initial_values">
<a class="viewcode-back" href="../../AllSkyCam4OLEODL.html#AllSkyCam4OLEODL.api.CameraControlSlider.set_initial_values">[docs]</a>
    <span class="k">def</span> <span class="nf">set_initial_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">exposure</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">min_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_value</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the intial values for all the varibales of the sliders.</span>

<span class="sd">        1. Gets the maximum and minimum spot size and exposure values and converts them to a logarithmic scale.</span>

<span class="sd">        2. Sets initial values of the sliders.</span>

<span class="sd">        3. Calls the update fuctions to set an inicial value for the variables.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Instance): Current instance, provides access to attributes and methods.</span>
<span class="sd">            exposure (float): Initial exposure time.</span>
<span class="sd">            min_value (int): Initial minimum spot size value.</span>
<span class="sd">            max_value (int): Initial maximum spot size value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_exposure</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_exposure</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_exposure</span><span class="p">,</span> <span class="n">exposure</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_exposure</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_exposure</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_exposure</span><span class="p">)</span>
            <span class="o">*</span> <span class="mi">1000</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="n">min_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">max_value</span>
        <span class="n">log_min_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
            <span class="o">*</span> <span class="mi">1000</span>
        <span class="p">)</span>
        <span class="n">log_max_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_max_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_min_value</span><span class="p">)</span>
            <span class="o">*</span> <span class="mi">1000</span>
        <span class="p">)</span>
        <span class="c1"># Sets inital values of the sliders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exposure_slider</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">log_exposure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_slider</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">log_min_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_slider</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">log_max_value</span><span class="p">)</span>
        <span class="c1"># Sets inital values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_exposure</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_min_value</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_max_value</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Iker Aldasoro.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>